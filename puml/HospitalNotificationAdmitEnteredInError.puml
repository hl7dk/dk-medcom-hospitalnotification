@startuml HNAdmitEnteredInError

'layout
skinparam class {
    BackgroundColor White
    BorderColor Black
    ArrowColor Black
  }
hide circle
hide empty members
skinparam SameClassWidth true
skinparam Ranksep 10


'title
title Simplified example: Admit and cancel admission for inpatient

'Message 1: Admit inpatient
package "Message 1: Admit Inpatient" as admit <<Frame>>{
    class "Bundle (MedComHospitalNotificationMessage)" as admitB{
        id = "a5e5b880-c087-4055-b9ec-99108695f81d"
        type = "message"
        timestamp = "2022-09-01T12:00:10"
    }
    class "MessageHeader (MedComHospitalNotificationMessageHeader)" as admitMH{
        id = "b9b4818e-02de-4cc4-b418-d20cbc7b5404"
        event.system = "http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-eventCodes"
        event.code = "hospital-notification-message"
        destination.use.system = "http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-destinationUse"
        destination.use.code = "primary"
        destination.endpoint = "https://sor2.sum.dsdn.dk/#id=953741000016009"
        destination.receiver.reference = "Organization/o4cdf292-abf3-4f5f-80ea-60a48013ff6d"
        sender.reference = "Organization/o7056980-a8b2-42aa-8a0e-c1fc85d1f40d"
        source.endpoint = "https://sor2.sum.dsdn.dk/#id=265161000016000"
        reportOfAdmissionFlag = "true"
        reportofAdmissionRecipient = "Organization/o7056980-a8b2-42aa-8a0e-c1fc85d1f40d"
        focus = "Encounter/a790f964-88d3-4652-bbc8-81d2f3d035f8"
    }
    class "Patient (MedComCorePatient)" as admitPT{
        id = "t33cef33-3626-422b-955d-d506aaa65fe1"
        identifier.system = "urn:oid:1.2.208.176.1.2"
        identifier.value = "2509479989"
        name.use = "official"
        name.family = "Elmer"
        name.given[0] = "Bruno"
        name.given[1] = "Test"
    }
    class "Encounter (MedComHospitalNotificationEncounter)" as admitENC{
        id = "a790f964-88d3-4652-bbc8-81d2f3d035f8"
        status.system = "http://medcomfhir.dk/ig/terminology/ValueSet/medcom-hospitalNotification-encounterStatus"
        status.code = "in-progress"
        class.system = "http://terminology.hl7.org/CodeSystem/v3-ActCode"
        class.code = "IMP"
        subject = "Patient/t33cef33-3626-422b-955d-d506aaa65fe1"
        episodeOfCare.identifier.system = "https://www.esundhed.dk/Registre/Landspatientsregisteret"
        episodeOfCare.identifier.value = "urn:uuid:fc60e762-b13b-5773-865e-67f3907bdcc7"
        period.start = "2022-09-01T12:00:05+02:00"
        serviceProvider = "Organization/o7056980-a8b2-42aa-8a0e-c1fc85d1f40d"
    }    
    class "Receiver: Municipality (MedComMessagingOrganization)" as admitROrg{
        id = "o4cdf292-abf3-4f5f-80ea-60a48013ff6d"
        identifier[0].system = "https://www.gs1.org/gln"
        identifier[0].value = "5790001348120"
        identifier[1].system = "urn:oid:1.2.208.176.1.1"
        identifier[1].value = "953741000016009"
    }
    class "Sender: Hospital (MedComMessagingOrganization)" as admitSOrg{
        id = "o7056980-a8b2-42aa-8a0e-c1fc85d1f40d"
        identifier[0].system = "https://www.gs1.org/gln"
        identifier[0].value = "5790000209354"
        identifier[1].system = "urn:oid:1.2.208.176.1.1"
        identifier[1].value = "265161000016000"
    }
    class "Provenance  (MedComMessagingProvenance)" as admitPRO{
        id = "a7128eb7-8df1-4479-b56f-9c66970159f6"
        target = "MessageHeader/b9b4818e-02de-4cc4-b418-d20cbc7b5404"
        occuredDateTime = "2022-09-01T12:00:30+02:00"
        recorded = "2022-09-01T12:00:30"
        activity.system = "http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-activityCodes"
        activity.code = "admit-inpatient"
        agent.who = "Organization/o7056980-a8b2-42aa-8a0e-c1fc85d1f40d"
    }

admitB -[hidden]- admitMH
admitMH-[hidden]-admitPT
admitPT-[hidden]-admitENC
admitENC-[hidden]-admitROrg
admitROrg-[hidden]-admitSOrg
admitSOrg-[hidden]-admitPRO
}

'Message 2: Entered in Error inpatient
package "Message 2: Cancel Admission of Inpatient" as error <<Frame>> {
class "Bundle  (MedComHospitalNotificationMessage)" as errorB{
        id = "c83671a4-9584-11ec-b909-0242ac120002"
        type = "message"
        timestamp = "2022-09-01T14:00:05"
    }
    class "MessageHeader  (MedComHospitalNotificationMessageHeader)" as errorMH{
        id = "d8749b54-1aeb-4089-8941-8d876bdffc51"
        event.system = "http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-eventCodes"
        event.code = "hospital-notification-message"
        destination.use.system = "http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-destinationUse"
        destination.use.code = "primary"
        destination.endpoint = "https://sor2.sum.dsdn.dk/#id=953741000016009"
        destination.receiver.reference = "Organization/0cfcaed6-067d-4c66-92eb-690d26b333bc"
        sender.reference = "Organization/d6ed6725-1aec-42ad-829d-f7074c3914f3"
        source.endpoint = "https://sor2.sum.dsdn.dk/#id=265161000016000"
        focus = "Encounter/c9782061-ce63-41b5-8be6-655812d23332"
    }
    class "Patient  (MedComCorePatient)" as errorPT{
        id = "b4055f9c-56ed-472b-b51e-be53652fd0aa"
        identifier.system = "urn:oid:1.2.208.176.1.2"
        identifier.value = "2509479989"
        name.use = "official"
        name.family = "Elmer"
        name.given[0] = "Bruno"
        name.given[1] = "Test"
    }
    class "Encounter  (MedComHospitalNotificationEncounter)" as errorENC{
        id = "c9782061-ce63-41b5-8be6-655812d23332"
        status.system = "http://medcomfhir.dk/ig/terminology/ValueSet/medcom-hospitalNotification-encounterStatus"
        status.code = "entered-in-error"
        class.system = "http://terminology.hl7.org/CodeSystem/v3-ActCode"
        class.code = "IMP"
        subject = "Patient/b4055f9c-56ed-472b-b51e-be53652fd0aa"
        episodeOfCare.identifier.system = "https://www.esundhed.dk/Registre/Landspatientsregisteret"
        episodeOfCare.identifier.value = "urn:uuid:fc60e762-b13b-5773-865e-67f3907bdcc7"
        period.start = "2022-09-01T12:00:05+02:00"
        serviceProvider = "Organization/d6ed6725-1aec-42ad-829d-f7074c3914f3"
    }    
    class "Receiver: Municipality (MedComMessagingOrganization)" as errorROrg{
        id = "0cfcaed6-067d-4c66-92eb-690d26b333bc"
        identifier[0].system = "https://www.gs1.org/gln"
        identifier[0].value = "5790001348120"
        identifier[1].system = "urn:oid:1.2.208.176.1.1"
        identifier[1].value = "953741000016009"
    }
    class "Sender: Hospital (MedComMessagingOrganization)" as errorSOrg{
        id = "d6ed6725-1aec-42ad-829d-f7074c3914f3"
        identifier[0].system = "https://www.gs1.org/gln"
        identifier[0].value = "5790000209354"
        identifier[1].system = "urn:oid:1.2.208.176.1.1"
        identifier[1].value = "265161000016000"
    }
    class "Provenance (MedComMessagingProvenance)" as admiterrorPRO{
        id = "a7128eb7-8df1-4479-b56f-9c66970159f6"
        target = "MessageHeader/b9b4818e-02de-4cc4-b418-d20cbc7b5404"
        occuredDateTime = "2022-09-01T12:00:30+02:00"
        recorded = "2022-09-01T12:00:30"
        activity.system = "http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-activityCodes"
        activity.code = "admit-inpatient"
        agent.who = "Organization/d6ed6725-1aec-42ad-829d-f7074c3914f3"
    }
    class "Provenance (MedComMessagingProvenance)" as errorPRO{
        id = "dc421d0a-cded-470f-9a53-2ddba7583baa"
        target = "MessageHeader/d8749b54-1aeb-4089-8941-8d876bdffc51"
        occuredDateTime = "2022-09-01T14:00:25+02:00"
        recorded = "2022-09-01T14:00:25"
        activity.system = "http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-activityCodes"
        activity.code = "cancel-admit-inpatient"
        agent.who = "Organization/d6ed6725-1aec-42ad-829d-f7074c3914f3"
        entity.role.system = "http://hl7.org/fhir/ValueSet/provenance-entity-role"
        entity.role.value = "removal"
        entity.what = "MessageHeader/b9b4818e-02de-4cc4-b418-d20cbc7b5404"
    }
errorB-[hidden]-errorMH
errorMH-[hidden]-errorPT
errorPT-[hidden]-errorENC
errorENC-[hidden]-errorROrg
errorROrg-[hidden]-errorSOrg
errorSOrg-[hidden]-admiterrorPRO
admiterrorPRO-[hidden]-errorPRO

}

' pile mellem de to beskeder
' admit --> error


@enduml

